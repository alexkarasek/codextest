<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Persona Debate Orchestrator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,600;9..144,700&family=Work+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div>
        <div class="topbar-meta">
          <p class="eyebrow">Round-Table Intelligence Studio</p>
          <div class="system-menu-shell">
            <button id="system-menu-toggle" class="system-menu-toggle" type="button" aria-expanded="false">Menu</button>
            <div id="system-menu-popout" class="system-menu-popout hidden">
              <div id="auth-user-chip" class="muted">Guest</div>
              <button id="auth-open-login" type="button">Login / Switch User</button>
              <button id="auth-quick-logout" type="button">Logout</button>
              <button id="open-help-flyout" type="button">Help & Guides</button>
              <button id="open-security-tab" type="button">Users & Access</button>
            </div>
          </div>
        </div>
        <h1>Persona Debate Orchestrator</h1>
        <p class="muted">Local-first persona manager, debate runner, and transcript-aware chat.</p>
      </div>
      <img class="hero-art" src="/assets/debate-wave.svg" alt="Abstract illustration of connected debate nodes">
    </div>
  </header>

  <nav class="tabs">
    <button class="tab-btn active" data-tab="chats">1. Chats</button>
    <button class="tab-btn" data-tab="governance">2. Governance</button>
    <button class="tab-btn" data-tab="config">3. Admin & Config</button>
  </nav>
  <nav id="subnav-chats" class="subtabs hidden">
    <button id="chats-view-simple" class="subtab-btn active" type="button">Simple Chat</button>
    <button id="chats-view-group" class="subtab-btn" type="button">Group Chat</button>
  </nav>
  <nav id="subnav-config" class="subtabs hidden">
    <button id="config-view-personas" class="subtab-btn active" type="button">Personas</button>
    <button id="config-view-knowledge" class="subtab-btn" type="button">Knowledge Studio</button>
    <button id="config-view-rai" class="subtab-btn" type="button">Responsible AI</button>
    <button id="config-view-agentic" class="subtab-btn" type="button">Agentic</button>
    <button id="config-view-security" class="subtab-btn" type="button">Users & Access</button>
  </nav>

  <section id="auth-gate" class="panel stack auth-gate hidden">
    <h2>Sign In</h2>
    <div id="auth-bootstrap-panel" class="stack hidden">
      <div class="hint">No users exist yet. Create the first admin account.</div>
      <label>Admin Username<input id="bootstrap-username" type="text" placeholder="admin"></label>
      <label>Admin Password<input id="bootstrap-password" type="password" placeholder="at least 8 characters"></label>
      <button id="bootstrap-create" type="button">Create Admin</button>
      <div id="bootstrap-status" class="status"></div>
    </div>
    <div id="auth-login-panel" class="stack">
      <label>Username<input id="auth-username" type="text"></label>
      <label>Password<input id="auth-password" type="password"></label>
      <button id="auth-login" type="button">Login</button>
      <div id="auth-status" class="status"></div>
    </div>
  </section>

  <main>
    <section id="tab-personas" class="tab-section">
      <div class="grid two">
        <div class="panel">
          <h2>Persona List <span class="tip" tabindex="0">?<span class="tip-flyout">Search, filter by tag, then use actions on each card to edit, duplicate, delete, or add to debate.</span></span></h2>
          <div class="row">
            <input id="persona-search" type="text" placeholder="Search by id, name, description">
            <input id="persona-tag-filter" type="text" placeholder="Filter by tag">
            <button id="refresh-personas" type="button">Refresh</button>
          </div>
          <div id="persona-errors" class="error"></div>
          <div id="persona-list" class="list"></div>
        </div>

        <div class="panel">
          <h2 id="persona-form-title">Create Persona <span class="tip" tabindex="0">?<span class="tip-flyout">`id`, `displayName`, and `systemPrompt` are required. Optional fields can be inferred from the prompt.</span></span></h2>
          <form id="persona-form" class="stack">
            <label>Id (slug) <span class="tip" tabindex="0">?<span class="tip-flyout">Lowercase letters, numbers, and dashes only. Example: policy-analyst.</span></span><input name="id" required placeholder="policy-analyst"></label>
            <label>Display Name <span class="tip" tabindex="0">?<span class="tip-flyout">Human-readable name shown in debate turns.</span></span><input name="displayName" required></label>
            <label>Role/Title<input name="role"></label>
            <label>Description<input name="description" placeholder="Optional: auto-derived from prompt if blank"></label>
            <label>System Prompt <span class="tip" tabindex="0">?<span class="tip-flyout">Primary instruction for this persona. Keep it specific and behavior-focused.</span></span><textarea name="systemPrompt" rows="6" required></textarea></label>
            <label>Speaking Tone<input name="tone" placeholder="calm, direct"></label>
            <label>Speaking Verbosity<input name="verbosity" placeholder="concise"></label>
            <label>Speaking Quirks (comma-separated)<input name="quirks"></label>
            <label>Expertise Tags (comma-separated)<input name="expertiseTags"></label>
            <label>Bias/Values (comma-separated or text)<textarea name="biasValues" rows="2"></textarea></label>
            <label>Debate Behavior<textarea name="debateBehavior" rows="3" placeholder="Steelman first, ask one clarifying question."></textarea></label>
            <div class="stack">
              <div>Persona Knowledge Packs <span class="tip" tabindex="0">?<span class="tip-flyout">Optional specialized knowledge this persona can access in every debate turn.</span></span></div>
              <div id="persona-knowledge-pack-list" class="list"></div>
            </div>
            <div class="row">
              <button type="submit">Save Persona</button>
              <button id="persona-reset" type="button">Reset</button>
            </div>
          </form>
          <h3>Preview</h3>
          <pre id="persona-preview" class="preview"></pre>
          <div id="persona-status" class="status"></div>
        </div>
      </div>
    </section>

    <section id="tab-knowledge" class="tab-section">
      <div class="grid two">
        <div class="panel stack">
          <h2>Knowledge Studio</h2>
          <div class="hint">Upload source files and convert them into reusable knowledge packs. Supported: .txt, .pdf, .jpg/.jpeg/.png, .doc, .docx</div>
          <form id="knowledge-upload-form" class="stack">
            <label>File<input id="knowledge-upload-file" type="file" accept=".txt,.pdf,.jpg,.jpeg,.png,.doc,.docx" required></label>
            <label>Title (optional)<input id="knowledge-upload-title" type="text" placeholder="Auto-derived from filename if empty"></label>
            <label>Id (optional slug)<input id="knowledge-upload-id" type="text" placeholder="Auto-generated if empty"></label>
            <label>Tags (comma-separated)<input id="knowledge-upload-tags" type="text" placeholder="policy, economics, technology"></label>
            <label>Description (optional)<textarea id="knowledge-upload-description" rows="3" placeholder="Optional description for this pack"></textarea></label>
            <div class="row">
              <button type="submit">Upload + Convert</button>
              <button id="knowledge-refresh" type="button">Refresh Packs</button>
            </div>
          </form>
          <div id="knowledge-upload-status" class="status"></div>
        </div>
        <div class="panel stack">
          <h2>Knowledge Pack Library</h2>
          <div id="knowledge-studio-list" class="list"></div>
        </div>
      </div>
    </section>

    <section id="tab-rai" class="tab-section">
      <div class="grid two">
        <div class="panel stack">
          <h2>Responsible AI Policy</h2>
          <div class="hint">Configure stoplight and sentiment heuristics used for exchange-level signals in chat, debate viewer, and governance metrics.</div>
          <label>Red Keywords (one per line)<textarea id="rai-red-keywords" rows="10" placeholder="high risk terms"></textarea></label>
          <label>Yellow Keywords (one per line)<textarea id="rai-yellow-keywords" rows="10" placeholder="medium risk terms"></textarea></label>
          <label>Positive Sentiment Keywords (one per line)<textarea id="rai-positive-keywords" rows="8"></textarea></label>
          <label>Negative Sentiment Keywords (one per line)<textarea id="rai-negative-keywords" rows="8"></textarea></label>
          <label>Sentiment Threshold<input id="rai-sentiment-threshold" type="number" min="1" max="5" value="1"></label>
          <div class="row">
            <button id="rai-save" type="button">Save Policy</button>
            <button id="rai-reset-defaults" type="button">Reset to Defaults</button>
            <button id="rai-reload" type="button">Reload</button>
          </div>
          <div id="rai-status" class="status"></div>
        </div>

        <div class="panel stack">
          <h2>Policy Preview</h2>
          <div class="hint">Changes apply to newly rendered exchanges and governance calculations.</div>
          <pre id="rai-preview" class="preview"></pre>
        </div>
      </div>
    </section>

    <section id="tab-security" class="tab-section">
      <div class="grid two">
        <div class="panel stack">
          <h2>Current Session <span class="tip" tabindex="0">?<span class="tip-flyout">Manage login/logout and API keys for platform and external API access.</span></span></h2>
          <div id="security-session" class="status">Not authenticated.</div>
          <div class="row">
            <button id="security-refresh-session" type="button">Refresh Session</button>
            <button id="security-logout" type="button">Logout</button>
          </div>
          <h3>Create API Key</h3>
          <label>Key Label<input id="security-key-name" type="text" placeholder="Postman key"></label>
          <button id="security-create-key" type="button">Generate API Key</button>
          <div id="security-key-status" class="status"></div>
          <pre id="security-key-once" class="preview"></pre>
          <button id="security-copy-key" type="button" disabled>Copy API Key</button>
          <h3>Your API Keys</h3>
          <div id="security-api-keys" class="list"></div>
        </div>

        <div class="panel stack">
          <h2>User Administration</h2>
          <div class="hint">Admin users can create users, reset passwords, and set permissions.</div>
          <label>Username<input id="security-new-username" type="text"></label>
          <label>Password<input id="security-new-password" type="password"></label>
          <label>Role
            <select id="security-new-role">
              <option value="user" selected>User</option>
              <option value="admin">Admin</option>
            </select>
          </label>
          <button id="security-create-user" type="button">Create User</button>
          <div id="security-user-status" class="status"></div>
          <h3>Users</h3>
          <div id="security-users" class="list"></div>
          <h3>Usage by User</h3>
          <div id="security-usage" class="list"></div>
        </div>
      </div>
    </section>

    <section id="tab-agentic" class="tab-section">
      <div class="grid two">
        <div class="panel stack">
          <h2>Agentic Task Builder <span class="tip" tabindex="0">?<span class="tip-flyout">Create scaffold tasks with tool, LLM, or job steps. Use “requires approval” per step in the JSON.</span></span></h2>
          <div class="hint">This is scaffolding for agentic workflows. Start with a simple tool step, then add approvals and router tags.</div>
          <label>Goal Description<textarea id="agentic-goal" rows="3" placeholder="Describe what you want the system to do end-to-end."></textarea></label>
          <label>Planner Constraints<textarea id="agentic-constraints" rows="2" placeholder="Optional: keep under 5 steps, require approval before writes, etc."></textarea></label>
          <div class="row">
            <label>Planner Max Steps<input id="agentic-plan-max-steps" type="number" min="1" max="12" value="6"></label>
            <button id="agentic-generate-plan" type="button">Generate Plan from Goal</button>
          </div>
          <div class="row">
            <label>Workflow Preset
              <select id="agentic-preset-select"></select>
            </label>
            <button id="agentic-load-preset" type="button">Load Preset</button>
            <button id="agentic-reset-blank" type="button">Reset to Blank</button>
            <button id="agentic-save-template" type="button">Save Current as Template</button>
          </div>
          <pre id="agentic-plan-reasoning" class="preview"></pre>
          <label>Title<input id="agentic-task-title" type="text" value="Agentic Task"></label>
          <label>Objective<textarea id="agentic-task-objective" rows="3" placeholder="What should this task accomplish?"></textarea></label>
          <div class="grid two">
            <label>Team Mode
              <select id="agentic-team-mode">
                <option value="auto" selected>Auto</option>
                <option value="manual">Manual</option>
              </select>
            </label>
            <label>Max Agents<input id="agentic-team-max-agents" type="number" min="1" max="8" value="3"></label>
          </div>
          <label>Manual Persona IDs (comma-separated)<input id="agentic-team-persona-ids" type="text" placeholder="big-tex, policy-analyst"></label>
          <label>Router Tags (comma-separated)<input id="agentic-team-tags" type="text" placeholder="governance, finance, poker"></label>
          <div class="grid two">
            <label>Model<input id="agentic-task-model" type="text" value="gpt-4.1-mini"></label>
            <label>Temperature<input id="agentic-task-temperature" type="number" min="0" max="2" step="0.1" value="0.3"></label>
          </div>
          <h3>Step Builder</h3>
          <div class="hint">Build steps visually, then create task. You can reference prior outputs with templates like <code>{{steps.step-1.result.bodyPreview}}</code>.</div>
          <div class="row">
            <button id="agentic-step-add" type="button">Add Step</button>
            <button id="agentic-step-load-json" type="button">Load from JSON</button>
            <button id="agentic-step-apply-json" type="button">Apply Builder to JSON</button>
          </div>
          <div id="agentic-step-builder" class="list"></div>
          <label>Steps JSON<textarea id="agentic-steps-json" rows="12"></textarea></label>
          <div class="row">
            <button id="agentic-create-task" type="button">Create Task</button>
            <label class="inline"><input id="agentic-run-immediately" type="checkbox"> Run immediately</label>
            <button id="agentic-router-preview" type="button">Preview Team Routing</button>
          </div>
          <pre id="agentic-router-result" class="preview"></pre>
          <div id="agentic-task-status" class="status"></div>
        </div>

        <div class="panel stack">
          <h2>Task Monitor</h2>
          <div class="row">
            <button id="agentic-refresh" type="button">Refresh</button>
            <button id="agentic-run-selected" type="button">Run Selected Task</button>
          </div>
          <label>Task<select id="agentic-task-select"></select></label>
          <pre id="agentic-task-detail" class="preview"></pre>
          <h3>Pending Approvals</h3>
          <div id="agentic-approvals-list" class="list"></div>
          <h3>Tool Catalog</h3>
          <div id="agentic-tools-list" class="list"></div>
        </div>
      </div>

      <div class="grid two">
        <div class="panel stack">
          <h2>Metrics</h2>
          <div id="agentic-metrics-cards" class="summary-cards"></div>
          <div id="agentic-jobs-list" class="list"></div>
        </div>
        <div class="panel stack">
          <h2>Events + MCP Readiness</h2>
          <div id="agentic-mcp-status" class="status">MCP status not loaded.</div>
          <h3>Recent Task Events</h3>
          <pre id="agentic-task-events" class="preview"></pre>
          <h3>Recent Tool Usage</h3>
          <pre id="agentic-tool-events" class="preview"></pre>
        </div>
      </div>
    </section>

    <section id="tab-new-debate" class="tab-section">
      <div class="grid two">
        <div class="panel stack">
          <h2>Debate Setup <span class="tip" tabindex="0">?<span class="tip-flyout">Configure the topic, choose participants in order, then run. Turns execute sequentially.</span></span></h2>
          <div class="setup-step stack">
            <h3>Step 1: Define Topic</h3>
            <label>Topic/Title <span class="tip" tabindex="0">?<span class="tip-flyout">The debate question all personas will respond to each round.</span></span><input id="debate-topic" type="text" placeholder="Should cities ban private cars downtown?" required></label>
            <label>Context <span class="tip" tabindex="0">?<span class="tip-flyout">Optional background facts, constraints, or assumptions shared with all personas.</span></span><textarea id="debate-context" rows="4" placeholder="Optional background context"></textarea></label>
          </div>

          <details class="setup-advanced">
            <summary>Advanced Setup (Topic Discovery, Persona Generation, Settings, Knowledge, Participants)</summary>

          <div class="setup-step stack">
            <h3>Step 2: Discover Topic Sources (Optional)</h3>
            <div class="hint">Use current events search, or skip and work from your manual topic above.</div>
            <div class="row">
              <input id="topic-discovery-query" type="text" placeholder="Search current events (e.g., ai regulation, election policy)">
              <button id="topic-discovery-search" type="button">Search Events</button>
              <button id="topic-use-manual" type="button">Use Manual Topic</button>
            </div>
            <div id="topic-discovery-results" class="list"></div>
            <div id="topic-selected-summary" class="status">No current-event topic selected. Manual topic generation is available.</div>
          </div>

          <div class="setup-step stack">
            <h3>Step 3: Generate Personas (Optional)</h3>
            <div class="hint">Generates from selected event topic when available, otherwise from manual Topic/Context.</div>
            <div class="row">
              <label>Generated Personas<input id="topic-persona-count" type="number" min="1" max="6" value="3"></label>
              <button id="topic-generate-personas" type="button">Generate Personas</button>
            </div>
            <div id="topic-generated-drafts" class="list"></div>
          </div>

          <div class="setup-step stack">
            <h3>Step 4: Configure Debate Settings</h3>
          <div class="grid two">
            <label>Rounds <span class="tip" tabindex="0">?<span class="tip-flyout">Number of speaking rounds per persona. Higher values cost more tokens/time.</span></span><input id="debate-rounds" type="number" min="1" max="8" value="3"></label>
            <label>Max Words / Turn <span class="tip" tabindex="0">?<span class="tip-flyout">Hard target for brevity in each generated turn.</span></span><input id="debate-max-words" type="number" min="40" max="400" value="120"></label>
            <label>Temperature<input id="debate-temperature" type="number" min="0" max="2" step="0.1" value="0.7"></label>
            <label>Model<input id="debate-model" type="text" value="gpt-4.1-mini"></label>
            <label>Source Grounding
              <select id="debate-source-grounding">
                <option value="light" selected>Light</option>
                <option value="strict">Strict</option>
                <option value="off">Off</option>
              </select>
            </label>
          </div>
          <label>Moderation Style<input id="debate-moderation-style" type="text" value="neutral"></label>
          <label class="inline"><input id="debate-include-moderator" type="checkbox" checked> Include moderator</label>
          </div>
          <div class="setup-step stack">
          <h3>Step 5: Attach Knowledge (Optional)</h3>
          <div class="hint">These packs are global to all participants. Persona-specific packs can be set in Persona profiles.</div>
          <div id="knowledge-pack-list" class="list"></div>
          </div>

          <div class="setup-step stack">
            <h3>Step 6: Select Participants</h3>
            <h3>Available Saved Personas</h3>
            <div id="available-personas" class="list"></div>

            <h3>Add Ad-hoc Persona <span class="tip" tabindex="0">?<span class="tip-flyout">Use this for one-off participants. Enable “Save persona” to persist into data/personas.</span></span></h3>
            <div class="stack">
              <label>Display Name<input id="adhoc-displayName" type="text"></label>
              <label>Description<input id="adhoc-description" type="text"></label>
              <label>System Prompt<textarea id="adhoc-systemPrompt" rows="4"></textarea></label>
              <label>Role<input id="adhoc-role" type="text"></label>
              <label>Tone<input id="adhoc-tone" type="text"></label>
              <label>Verbosity<input id="adhoc-verbosity" type="text"></label>
              <label>Quirks (comma-separated)<input id="adhoc-quirks" type="text"></label>
              <label>Expertise Tags (comma-separated)<input id="adhoc-tags" type="text"></label>
              <label>Bias/Values<input id="adhoc-bias" type="text"></label>
              <label>Debate Behavior<textarea id="adhoc-debateBehavior" rows="2"></textarea></label>
              <label>Knowledge Pack Ids (comma-separated)<input id="adhoc-knowledge-pack-ids" type="text" placeholder="optional: debate-quality-rubric, current-events-analysis"></label>
              <label class="inline"><input id="adhoc-save" type="checkbox"> Save persona</label>
              <label>Save Id (required if save checked)<input id="adhoc-id" type="text" placeholder="new-persona-id"></label>
              <button id="add-adhoc" type="button">Add Ad-hoc Persona</button>
            </div>
          </div>
          </details>
        </div>

        <div class="panel stack">
          <h2>Selected Personas (Ordered) <span class="tip" tabindex="0">?<span class="tip-flyout">Order controls speaking sequence each round. Use Up/Down before running.</span></span></h2>
          <div class="hint">
            Run path:
            <strong>Option A</strong> add/reorder personas manually.
            <strong>Option B</strong> leave this list empty and the orchestrator auto-selects personas from saved profiles.
          </div>
          <div id="selected-personas" class="list"></div>
          <button id="run-debate" type="button">Run Debate</button>
          <div id="debate-run-status" class="status"></div>
        </div>
      </div>
    </section>

    <section id="tab-simple-chat" class="tab-section">
      <div class="grid two">
        <div class="panel stack">
          <h2>Simple Chat <span class="tip" tabindex="0">?<span class="tip-flyout">Single-assistant conversation with optional knowledge grounding and session history.</span></span></h2>
          <label>Chat Title<input id="simple-chat-title" type="text" value="Simple Chat"></label>
          <label>Shared Context<textarea id="simple-chat-context" rows="3" placeholder="Optional background instructions for this chat"></textarea></label>
          <div class="grid two">
            <label>Model
              <select id="simple-chat-model">
                <option value="gpt-4.1-mini" selected>gpt-4.1-mini</option>
                <option value="gpt-4.1">gpt-4.1</option>
                <option value="gpt-4o-mini">gpt-4o-mini</option>
                <option value="gpt-4o">gpt-4o</option>
              </select>
            </label>
            <label>Temperature<input id="simple-chat-temperature" type="number" min="0" max="2" step="0.1" value="0.4"></label>
            <label>Max Response Words<input id="simple-chat-max-words" type="number" min="40" max="800" value="220"></label>
          </div>
          <h3>Knowledge Packs (Optional)</h3>
          <div id="simple-chat-knowledge-list" class="list"></div>
          <div class="row">
            <button id="simple-chat-create" type="button">Create Simple Chat</button>
            <button id="simple-chat-refresh-list" type="button">Refresh Sessions</button>
          </div>
          <div id="simple-chat-create-status" class="status"></div>
          <h3>Saved Sessions</h3>
          <div id="simple-chat-session-list" class="list"></div>
        </div>

        <div class="panel stack">
          <h2>Conversation <span class="tip" tabindex="0">?<span class="tip-flyout">Load a session and continue chatting. Risk/sentiment chips appear per message.</span></span></h2>
          <div class="row">
            <label>Chat Id<input id="simple-chat-id" type="text" placeholder="Create or load a simple chat id"></label>
            <button id="simple-chat-load" type="button">Load</button>
          </div>
          <div id="simple-chat-status" class="status">Create or load a simple chat session to begin.</div>
          <div id="simple-chat-history" class="chat-history"></div>
          <div class="row">
            <input id="simple-chat-message" type="text" placeholder="Ask anything, optionally grounded in selected knowledge packs">
            <button id="simple-chat-send" type="button">Send</button>
          </div>
          <div class="hint">Citations appear automatically when matching knowledge pack evidence is found.</div>
        </div>
      </div>
    </section>

    <section id="tab-persona-chat" class="tab-section">
      <div class="grid two">
        <div class="panel stack">
          <h2>Persona Collaboration Chat <span class="tip" tabindex="0">?<span class="tip-flyout">Create a free-form chat session with one or more personas. An orchestrator picks the most relevant subset each turn, so not everyone replies every time.</span></span></h2>
          <div class="row">
            <button id="group-work-live" type="button">Live Group Chat</button>
            <button id="group-work-debate-setup" type="button">Formal Debate Setup</button>
            <button id="group-work-debate-viewer" type="button">History Explorer</button>
          </div>
          <label>Chat Title<input id="persona-chat-title" type="text" value="Persona Collaboration Chat"></label>
          <label>Shared Context<textarea id="persona-chat-context" rows="3" placeholder="Optional context shared across all persona responses"></textarea></label>
          <div class="grid two">
            <label>Model<input id="persona-chat-model" type="text" value="gpt-4.1-mini"></label>
            <label>Temperature<input id="persona-chat-temperature" type="number" min="0" max="2" step="0.1" value="0.6"></label>
            <label>Max Words / Persona Turn<input id="persona-chat-max-words" type="number" min="40" max="400" value="140"></label>
            <label>Engagement Mode
              <select id="persona-chat-mode">
                <option value="chat" selected>Chat</option>
                <option value="panel">Panel Discussion</option>
                <option value="debate-work-order">Debate + Work Order</option>
              </select>
            </label>
          </div>
          <h3>Select Personas (One or More)</h3>
          <div id="persona-chat-persona-list" class="list"></div>
          <div class="row">
            <button id="persona-chat-create" type="button">Create Chat Session</button>
            <button id="persona-chat-new-draft" type="button">New Chat Draft</button>
            <button id="persona-chat-refresh-list" type="button">Refresh Sessions</button>
          </div>
          <div id="persona-chat-create-status" class="status"></div>
          <h3>Saved Sessions</h3>
          <div id="persona-chat-session-list" class="list"></div>
        </div>

        <div class="panel stack">
          <h2>Conversation <span class="tip" tabindex="0">?<span class="tip-flyout">Load group sessions and continue collaboration with selected personas.</span></span></h2>
          <div class="row">
            <label>Chat Id<input id="persona-chat-id" type="text" placeholder="Create or load a chat id"></label>
            <button id="persona-chat-load" type="button">Load</button>
          </div>
          <div id="persona-chat-status" class="status">Create or load a persona chat session to begin.</div>
          <div id="persona-chat-history" class="chat-history"></div>
          <div class="row">
            <input id="persona-chat-message" type="text" placeholder="Ask your selected personas anything">
            <button id="persona-chat-send" type="button">Send</button>
          </div>
        </div>
      </div>
    </section>

    <section id="tab-viewer" class="tab-section">
      <div class="panel stack">
        <h2>History Explorer <span class="tip" tabindex="0">?<span class="tip-flyout">Browse conversation history by type. Select and open any session to monitor exchange-level risk flags.</span></span></h2>
        <div class="row">
          <label>Type
            <select id="viewer-conversation-type">
              <option value="debate" selected>Debate</option>
              <option value="group">Group Chat</option>
              <option value="simple">Simple Chat</option>
            </select>
          </label>
          <label>Conversation
            <select id="viewer-conversation-select">
              <option value="">Select conversation</option>
            </select>
          </label>
          <button id="load-conversation" type="button">Load</button>
          <a id="download-transcript" href="#" target="_blank" rel="noopener">Download Transcript</a>
        </div>
        <div id="viewer-history-list" class="list"></div>
        <div id="viewer-progress" class="status"></div>
        <pre id="viewer-transcript" class="transcript"></pre>
        <div class="panel stack">
          <h3>Exchange Risk Signals</h3>
          <div class="hint">Stoplight indicators are heuristic signals based on text content and sentiment terms.</div>
          <div id="viewer-turns" class="chat-history"></div>
        </div>
        <div id="viewer-transcript-chat" class="chatbox stack">
          <h3>Transcript Chat</h3>
          <div class="hint">
            Ask questions about the currently loaded debate transcript. Responses are grounded in transcript excerpts.
          </div>
          <div id="chat-history" class="chat-history"></div>
          <div class="row">
            <input id="chat-question" type="text" placeholder="Ask about arguments, agreements, or takeaways">
            <button id="chat-send" type="button">Ask</button>
            <button id="chat-citations-open" type="button">Show Citations</button>
          </div>
          <div id="chat-status" class="status"></div>
        </div>
      </div>
    </section>

    <section id="tab-admin" class="tab-section">
      <div class="grid two">
        <div class="panel stack">
          <h2>Governance Dashboard <span class="tip" tabindex="0">?<span class="tip-flyout">Use matrix drilldowns to inspect usage, cost, risk, sentiment, and user dimensions.</span></span></h2>
          <div id="admin-summary-cards" class="summary-cards"></div>
          <div class="admin-matrix-controls row">
            <span class="hint">Matrix Dimension</span>
            <button id="admin-dim-channel" type="button">Channel</button>
            <button id="admin-dim-model" type="button">Model</button>
            <button id="admin-dim-persona" type="button">Persona</button>
            <button id="admin-dim-user" type="button">User</button>
            <button id="admin-clear-filter" type="button">Clear Drill Filter</button>
          </div>
          <div id="admin-filter-summary" class="hint">No active drill filter.</div>
          <div id="admin-matrix" class="admin-matrix"></div>
          <div class="row">
            <button id="admin-view-debates" type="button">Debate View</button>
            <button id="admin-view-chats" type="button">Chat View</button>
            <button id="admin-view-personas" type="button">Persona View</button>
            <button id="admin-refresh" type="button">Refresh</button>
          </div>
          <div id="admin-pricing-note" class="hint"></div>
          <div id="admin-list" class="list"></div>
        </div>

        <div class="panel stack">
          <h2>Visual Analytics</h2>
          <div id="admin-chart-status" class="status">Charts update from current matrix filters.</div>
          <div id="admin-charts" class="stack"></div>
          <div class="row">
            <button id="admin-nav-group-history" type="button">Open Group Chat History</button>
            <button id="admin-nav-simple-history" type="button">Open Simple Chat History</button>
            <button id="admin-nav-debate-history" type="button">Open History Explorer</button>
          </div>
          <h3>Governance Admin Chat <span class="tip" tabindex="0">?<span class="tip-flyout">Admin-only chat backed by a hidden governance dataset knowledge pack and hidden governance persona.</span></span></h3>
          <div class="row">
            <button id="gov-chat-create" type="button">New Governance Chat</button>
            <label>Find Past Chat<input id="gov-chat-search" type="text" placeholder="Search by id or title"></label>
            <button id="gov-chat-search-btn" type="button">Search</button>
          </div>
          <div id="gov-chat-create-status" class="status">Create or load a governance chat session.</div>
          <div id="gov-chat-search-status" class="hint hidden">Search results appear here.</div>
          <div id="gov-chat-session-list" class="list hidden"></div>
          <div class="row">
            <label>Chat Id<input id="gov-chat-id" type="text" placeholder="Load governance chat id"></label>
            <button id="gov-chat-load" type="button">Load</button>
          </div>
          <div id="gov-chat-status" class="status">No governance chat loaded.</div>
          <div id="gov-chat-history" class="chat-history"></div>
          <div class="row">
            <input id="gov-chat-message" type="text" placeholder="Ask governance questions (cost, tokens, risky users, topics)">
            <button id="gov-chat-send" type="button">Send</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <aside id="citations-popout" class="citations-popout" aria-hidden="true">
    <div class="citations-header">
      <h3>Citations</h3>
      <button id="chat-citations-close" type="button">Close</button>
    </div>
    <div id="chat-citations-list" class="citations-list"></div>
  </aside>

  <aside id="help-popout" class="citations-popout" aria-hidden="true">
    <div class="citations-header">
      <h3 id="help-title">Usage Guide</h3>
      <button id="help-close" type="button">Close</button>
    </div>
    <div id="help-body" class="citations-list"></div>
  </aside>

  <script type="module" src="/app.js"></script>
</body>
</html>
