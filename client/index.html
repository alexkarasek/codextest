<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Agentic AI Workbench</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,600;9..144,700&family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css?v=20260218">
  <style id="theme-vars"></style>
  <script>
    (function loadThemeEarly() {
      const styleTag = document.getElementById("theme-vars");
      function applyTheme(theme) {
        if (!theme || typeof theme !== "object") return;
        const vars = theme.variables && typeof theme.variables === "object" ? theme.variables : {};
        const typography = theme.typography && typeof theme.typography === "object" ? theme.typography : {};
        const lines = [":root {"];
        Object.entries(vars).forEach(([key, value]) => {
          if (!key || typeof value === "undefined") return;
          lines.push(`  ${String(key)}: ${String(value)};`);
        });
        if (typography.body) lines.push(`  --font-body: ${String(typography.body)};`);
        if (typography.display) lines.push(`  --font-display: ${String(typography.display)};`);
        lines.push("}");
        styleTag.textContent = lines.join("\\n");
      }

      fetch("/theme", { credentials: "include" })
        .then((res) => res.json())
        .then((payload) => applyTheme(payload?.data?.theme || payload?.theme || null))
        .catch(() => {});
    })();
  </script>
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div>
        <div class="topbar-menu-row">
          <div class="system-menu-shell">
            <button id="system-menu-toggle" class="system-menu-toggle" type="button" aria-expanded="false">Menu</button>
            <div id="system-menu-popout" class="system-menu-popout hidden">
              <div id="auth-user-chip" class="muted">Guest</div>
              <button id="auth-open-login" type="button">Login / Switch User</button>
              <button id="auth-quick-logout" type="button">Logout</button>
              <button id="open-documentation-page" type="button">Documentation</button>
              <button id="open-support-page" type="button">Support</button>
              <button id="open-help-flyout" type="button">Help & Guides</button>
              <button id="open-security-tab" type="button">Users & Access</button>
            </div>
          </div>
        </div>
        <div class="topbar-meta">
          <p class="eyebrow">Round-Table Intelligence Studio</p>
        </div>
        <h1>Agentic AI Workbench</h1>
        <p class="muted">Local-first persona manager with conversation modes, orchestration, and governance analytics.</p>
      </div>
      <div class="hero-logo-shell">
        <img id="hero-logo" class="hero-art" src="/media/logo" alt="Product logo">
        <div class="row hero-logo-actions">
          <input id="logo-upload-input" type="file" accept=".png,.jpg,.jpeg,.webp,.gif,.svg" class="hidden">
          <button id="logo-upload-trigger" type="button">Edit Logo</button>
        </div>
      </div>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab-btn active tab-expandable" data-tab="chats">1. Chats <span class="tab-caret">‚ñæ</span></button>
    <button class="tab-btn" data-tab="governance">2. Governance</button>
    <button class="tab-btn" data-tab="config">3. Admin & Config</button>
  </nav>
  <nav id="subnav-chats" class="subtabs">
    <span class="subtabs-hint">Choose chat mode:</span>
    <button id="chats-view-simple" class="subtab-btn active" type="button">Simple Chat</button>
    <button id="chats-view-group" class="subtab-btn" type="button">Persona Chat</button>
  </nav>
  <nav id="subnav-group-work" class="subtabs hidden">
    <button id="group-nav-live" class="subtab-btn" type="button">Live Persona Chat</button>
    <button id="group-nav-debate-viewer" class="subtab-btn" type="button">Conversation Explorer</button>
  </nav>
  <nav id="subnav-config" class="subtabs hidden">
    <button id="config-view-personas" class="subtab-btn active" type="button">Personas</button>
    <button id="config-view-knowledge" class="subtab-btn" type="button">Knowledge Studio</button>
    <button id="config-view-rai" class="subtab-btn" type="button">Responsible AI</button>
    <button id="config-view-agentic" class="subtab-btn" type="button">Agentic</button>
    <button id="config-view-theme" class="subtab-btn" type="button">Theme</button>
    <button id="config-view-security" class="subtab-btn" type="button">Users & Access</button>
  </nav>

  <section id="auth-gate" class="panel stack auth-gate hidden">
    <div class="auth-gate-card stack">
      <h2>Sign In</h2>
      <div id="auth-bootstrap-panel" class="stack hidden">
        <div class="hint">No users exist yet. Create the first admin account.</div>
        <label>Admin Username<input id="bootstrap-username" type="text" placeholder="admin"></label>
        <label>Admin Password<input id="bootstrap-password" type="password" placeholder="at least 8 characters"></label>
        <button id="bootstrap-create" type="button">Create Admin</button>
        <div id="bootstrap-status" class="status"></div>
      </div>
      <div id="auth-login-panel" class="stack">
        <label>Username<input id="auth-username" type="text"></label>
        <label>Password<input id="auth-password" type="password"></label>
        <button id="auth-login" type="button">Login</button>
        <div id="auth-status" class="status"></div>
      </div>
    </div>
  </section>

  <main>
    <section id="tab-personas" class="tab-section">
      <div class="grid three">
        <div class="panel">
          <h2>Persona List <span class="tip" tabindex="0">?<span class="tip-flyout">Search, filter by tag, then use actions on each card to edit, duplicate, delete, or add to debate.</span></span></h2>
          <div class="row">
            <input id="persona-search" type="text" placeholder="Search by id, name, description">
            <input id="persona-tag-filter" type="text" placeholder="Filter by tag">
            <button id="refresh-personas" type="button">Refresh</button>
          </div>
          <div id="persona-errors" class="error"></div>
          <div id="persona-list" class="list"></div>
        </div>

        <div class="panel">
          <h2 id="persona-form-title">Create Persona <span class="tip" tabindex="0">?<span class="tip-flyout">`id`, `displayName`, and `systemPrompt` are required. Optional fields can be inferred from the prompt.</span></span></h2>
          <form id="persona-form" class="stack">
            <label>Id (slug) <span class="tip" tabindex="0">?<span class="tip-flyout">Lowercase letters, numbers, and dashes only. Example: policy-analyst.</span></span><input name="id" required placeholder="policy-analyst"></label>
            <label>Display Name <span class="tip" tabindex="0">?<span class="tip-flyout">Human-readable name shown in debate turns.</span></span><input name="displayName" required></label>
            <label>Avatar (emoji or image URL)<input name="avatar" placeholder="ü§ñ or https://.../avatar.png"></label>
            <label>Role/Title<input name="role"></label>
            <label>Description<input name="description" placeholder="Optional: auto-derived from prompt if blank"></label>
            <label>System Prompt <span class="tip" tabindex="0">?<span class="tip-flyout">Primary instruction for this persona. Keep it specific and behavior-focused.</span></span><textarea name="systemPrompt" rows="6" required></textarea></label>
            <label>Speaking Tone<input name="tone" placeholder="calm, direct"></label>
            <label>Speaking Verbosity<input name="verbosity" placeholder="concise"></label>
            <label>Speaking Quirks (comma-separated)<input name="quirks"></label>
            <label>Expertise Tags (comma-separated)<input name="expertiseTags"></label>
            <label>Bias/Values (comma-separated or text)<textarea name="biasValues" rows="2"></textarea></label>
            <label>Debate Behavior<textarea name="debateBehavior" rows="3" placeholder="Steelman first, ask one clarifying question."></textarea></label>
            <label>Tool IDs (comma-separated)<input name="toolIds" placeholder="http.request, web.fetch"></label>
            <div class="stack">
              <div>Persona Knowledge Packs <span class="tip" tabindex="0">?<span class="tip-flyout">Optional specialized knowledge this persona can access in every debate turn.</span></span></div>
              <div id="persona-knowledge-pack-list" class="list"></div>
            </div>
            <div class="row">
              <button type="submit">Save Persona</button>
              <button id="persona-reset" type="button">Reset</button>
            </div>
          </form>
          <h3>Preview</h3>
          <pre id="persona-preview" class="preview"></pre>
          <div id="persona-status" class="status"></div>
        </div>
      </div>
    </section>

    <section id="tab-knowledge" class="tab-section">
      <div class="grid two">
        <div class="panel stack">
          <h2>Knowledge Studio</h2>
          <div class="hint">Upload source files and convert them into reusable knowledge packs. Supported: .txt, .pdf, .jpg/.jpeg/.png, .doc, .docx</div>
          <form id="knowledge-upload-form" class="stack">
            <label>File<input id="knowledge-upload-file" type="file" accept=".txt,.pdf,.jpg,.jpeg,.png,.doc,.docx" required></label>
            <label>Title (optional)<input id="knowledge-upload-title" type="text" placeholder="Auto-derived from filename if empty"></label>
            <label>Id (optional slug)<input id="knowledge-upload-id" type="text" placeholder="Auto-generated if empty"></label>
            <label>Tags (comma-separated)<input id="knowledge-upload-tags" type="text" placeholder="policy, economics, technology"></label>
            <label>Description (optional)<textarea id="knowledge-upload-description" rows="3" placeholder="Optional description for this pack"></textarea></label>
            <div class="row">
              <button type="submit">Upload + Convert</button>
              <button id="knowledge-refresh" type="button">Refresh Packs</button>
            </div>
          </form>
          <div id="knowledge-upload-status" class="status"></div>
        </div>
        <div class="panel stack">
          <h2>Web Ingest</h2>
          <div class="hint">Fetch a web page and convert it into a knowledge pack.</div>
          <form id="knowledge-url-form" class="stack">
            <label>URL<input id="knowledge-url" type="url" placeholder="https://example.com" required></label>
            <label>Title (optional)<input id="knowledge-url-title" type="text" placeholder="Auto-derived from page title"></label>
            <label>Id (optional slug)<input id="knowledge-url-id" type="text" placeholder="Auto-generated if empty"></label>
            <label>Tags (comma-separated)<input id="knowledge-url-tags" type="text" placeholder="web, reports, benchmarks"></label>
            <label>Description (optional)<textarea id="knowledge-url-description" rows="3" placeholder="Optional description for this pack"></textarea></label>
            <label>Mode
              <select id="knowledge-url-mode">
                <option value="create" selected>Create new</option>
                <option value="append">Append to existing</option>
                <option value="overwrite">Overwrite existing</option>
              </select>
            </label>
            <label class="inline">
              <input id="knowledge-url-summarize" type="checkbox" checked>
              Summarize content
            </label>
            <div class="row">
              <button type="submit">Ingest URL</button>
              <button id="knowledge-url-preview" type="button">Preview URL</button>
              <button id="knowledge-url-reset" type="button">Reset</button>
            </div>
          </form>
          <div id="knowledge-url-status" class="status"></div>
          <details id="knowledge-url-preview-panel">
            <summary>Preview fetched text</summary>
            <div class="hint">Preview extracts readable text only; it is not stored unless you ingest.</div>
            <pre id="knowledge-url-preview-output" class="preview"></pre>
          </details>
          <h3>Web Access Policy</h3>
          <div class="hint">Optionally restrict domains that can be fetched during web ingest or agent tools.</div>
          <label>Allowlist domains (one per line)
            <textarea id="knowledge-web-allowlist" rows="4" placeholder="example.com&#10;docs.example.org"></textarea>
          </label>
          <label>Denylist domains (one per line)
            <textarea id="knowledge-web-denylist" rows="4" placeholder="ads.example.com"></textarea>
          </label>
          <div class="row">
            <button id="knowledge-web-policy-save" type="button">Save Web Policy</button>
          </div>
          <div id="knowledge-web-policy-status" class="status"></div>
        </div>
        <div class="panel stack">
          <h2>Knowledge Pack Library</h2>
          <div id="knowledge-studio-list" class="list"></div>
        </div>
      </div>
    </section>

    <section id="tab-rai" class="tab-section">
      <div class="grid two">
        <div class="panel stack">
          <h2>Responsible AI Policy</h2>
          <div class="hint">Configure stoplight and sentiment heuristics used for exchange-level signals in chat, debate viewer, and governance metrics.</div>
          <label>Red Keywords (one per line)<textarea id="rai-red-keywords" rows="10" placeholder="high risk terms"></textarea></label>
          <label>Yellow Keywords (one per line)<textarea id="rai-yellow-keywords" rows="10" placeholder="medium risk terms"></textarea></label>
          <label>Positive Sentiment Keywords (one per line)<textarea id="rai-positive-keywords" rows="8"></textarea></label>
          <label>Negative Sentiment Keywords (one per line)<textarea id="rai-negative-keywords" rows="8"></textarea></label>
          <label>Sentiment Threshold<input id="rai-sentiment-threshold" type="number" min="1" max="5" value="1"></label>
          <div class="row">
            <button id="rai-save" type="button">Save Policy</button>
            <button id="rai-reset-defaults" type="button">Reset to Defaults</button>
            <button id="rai-reload" type="button">Reload</button>
          </div>
          <div id="rai-status" class="status"></div>
        </div>

        <div class="panel stack">
          <h2>Policy Preview</h2>
          <div class="hint">Changes apply to newly rendered exchanges and governance calculations.</div>
          <pre id="rai-preview" class="preview"></pre>
        </div>
      </div>
    </section>

    <section id="tab-theme" class="tab-section">
      <div class="grid two">
        <div class="panel stack">
          <h2>Theme Editor</h2>
          <div class="hint">Edit theme variables and typography. Changes apply immediately after saving.</div>
          <label>Theme Variables (JSON)
            <textarea id="theme-variables-json" rows="12" placeholder='{"--bg":"#f6f8f7","--ink":"#1b2631"}'></textarea>
          </label>
          <label>Typography (JSON)
            <textarea id="theme-typography-json" rows="6" placeholder='{"body":"Space Grotesk, sans-serif","display":"Fraunces, serif"}'></textarea>
          </label>
          <div class="row">
            <button id="theme-save" type="button">Save Theme</button>
            <button id="theme-reset" type="button">Reset to Defaults</button>
          </div>
          <div id="theme-status" class="status"></div>
        </div>
        <div class="panel stack">
          <h2>Live Preview</h2>
          <div class="hint">Preview the current theme tokens.</div>
          <pre id="theme-preview" class="preview"></pre>
        </div>
      </div>
    </section>

    <section id="tab-security" class="tab-section">
      <div class="grid two">
        <div class="panel stack">
          <h2>Current Session <span class="tip" tabindex="0">?<span class="tip-flyout">Manage login/logout and API keys for platform and external API access.</span></span></h2>
          <div id="security-session" class="status">Not authenticated.</div>
          <div class="row">
            <button id="security-refresh-session" type="button">Refresh Session</button>
            <button id="security-logout" type="button">Logout</button>
          </div>
          <h3>Create API Key</h3>
          <label>Key Label<input id="security-key-name" type="text" placeholder="Postman key"></label>
          <button id="security-create-key" type="button">Generate API Key</button>
          <div id="security-key-status" class="status"></div>
          <pre id="security-key-once" class="preview"></pre>
          <button id="security-copy-key" type="button" disabled>Copy API Key</button>
          <h3>Your API Keys</h3>
          <div id="security-api-keys" class="list"></div>
          <h3>Demo Reset (Admin)</h3>
          <label>Reset Scope
            <select id="security-reset-scope">
              <option value="usage" selected>Usage Only (Chats/Runs/Events)</option>
              <option value="full">Full Reseed (also Personas + Knowledge)</option>
            </select>
          </label>
          <label class="inline"><input id="security-reset-keep-users" type="checkbox" checked> Keep users</label>
          <label class="inline"><input id="security-reset-keep-keys" type="checkbox" checked> Keep API keys</label>
          <label class="inline"><input id="security-reset-keep-settings" type="checkbox" checked> Keep settings</label>
          <label class="inline"><input id="security-reset-keep-logo" type="checkbox" checked> Keep logo</label>
          <button id="security-reset-run" type="button">Run Reset</button>
          <div id="security-reset-status" class="status"></div>
        </div>

        <div class="panel stack">
          <h2>User Administration</h2>
          <div class="hint">Admin users can create users, reset passwords, and set permissions.</div>
          <label>Username<input id="security-new-username" type="text"></label>
          <label>Password<input id="security-new-password" type="password"></label>
          <label>Role
            <select id="security-new-role">
              <option value="user" selected>User</option>
              <option value="admin">Admin</option>
            </select>
          </label>
          <button id="security-create-user" type="button">Create User</button>
          <div id="security-user-status" class="status"></div>
          <h3>Users</h3>
          <div id="security-users" class="list"></div>
          <h3>Usage by User</h3>
          <div id="security-usage" class="list"></div>
        </div>
      </div>
    </section>

    <section id="tab-agentic" class="tab-section">
      <div class="grid two">
        <div class="panel stack">
          <h2>Agentic Task Builder <span class="tip" tabindex="0">?<span class="tip-flyout">Create scaffold tasks with tool, LLM, or job steps. Use ‚Äúrequires approval‚Äù per step in the JSON.</span></span></h2>
          <div class="hint">This is scaffolding for agentic workflows. Start with a simple tool step, then add approvals and router tags.</div>
          <label>Goal Description<textarea id="agentic-goal" rows="3" placeholder="Describe what you want the system to do end-to-end."></textarea></label>
          <label>Planner Constraints<textarea id="agentic-constraints" rows="2" placeholder="Optional: keep under 5 steps, require approval before writes, etc."></textarea></label>
          <div class="row">
            <label>Planner Max Steps<input id="agentic-plan-max-steps" type="number" min="1" max="12" value="6"></label>
            <button id="agentic-generate-plan" type="button">Generate Plan from Goal</button>
          </div>
          <div class="row">
            <label>Workflow Preset
              <select id="agentic-preset-select"></select>
            </label>
            <button id="agentic-load-preset" type="button">Load Preset</button>
            <button id="agentic-reset-blank" type="button">Reset to Blank</button>
            <button id="agentic-save-template" type="button">Save Current as Template</button>
          </div>
          <pre id="agentic-plan-reasoning" class="preview"></pre>
          <label>Title<input id="agentic-task-title" type="text" value="Agentic Task"></label>
          <label>Objective<textarea id="agentic-task-objective" rows="3" placeholder="What should this task accomplish?"></textarea></label>
          <div class="grid two">
            <label>Team Mode
              <select id="agentic-team-mode">
                <option value="auto" selected>Auto</option>
                <option value="manual">Manual</option>
              </select>
            </label>
            <label>Max Agents<input id="agentic-team-max-agents" type="number" min="1" max="8" value="3"></label>
          </div>
          <label>Manual Persona IDs (comma-separated)<input id="agentic-team-persona-ids" type="text" placeholder="big-tex, policy-analyst"></label>
          <label>Router Tags (comma-separated)<input id="agentic-team-tags" type="text" placeholder="governance, finance, poker"></label>
          <div class="grid two">
            <label>Model
              <select id="agentic-task-model">
              </select>
            </label>
            <label>Temperature<input id="agentic-task-temperature" type="number" min="0" max="2" step="0.1" value="0.3"></label>
          </div>
          <div class="hint model-routing-hint">If `llmProvider` is set to Azure, this label is resolved through `azureInference.deployments` in `settings.local.json`.</div>
          <div id="agentic-task-model-meta" class="model-runtime-meta"></div>
          <h3>Step Builder</h3>
          <div class="hint">Build steps visually, then create task. You can reference prior outputs with templates like <code>{{steps.step-1.result.bodyPreview}}</code>.</div>
          <div class="row">
            <button id="agentic-step-add" type="button">Add Step</button>
            <button id="agentic-step-load-json" type="button">Load from JSON</button>
            <button id="agentic-step-apply-json" type="button">Apply Builder to JSON</button>
          </div>
          <div id="agentic-step-builder" class="list"></div>
          <label>Steps JSON<textarea id="agentic-steps-json" rows="12"></textarea></label>
          <div class="row">
            <button id="agentic-create-task" type="button">Create Task</button>
            <label class="inline"><input id="agentic-run-immediately" type="checkbox"> Run immediately</label>
            <button id="agentic-router-preview" type="button">Preview Team Routing</button>
          </div>
          <pre id="agentic-router-result" class="preview"></pre>
          <div id="agentic-task-status" class="status"></div>
          <h3>Watchers</h3>
          <div class="hint">Create a watcher that checks a URL or file and triggers a task when it changes.</div>
          <label>Watcher Name<input id="agentic-watcher-name" type="text" placeholder="Weekly status monitor"></label>
          <div class="grid two">
            <label>Type
              <select id="agentic-watcher-type">
                <option value="http" selected>HTTP</option>
                <option value="file">File</option>
              </select>
            </label>
            <label>Action
              <select id="agentic-watcher-action">
                <option value="task" selected>Trigger Task</option>
                <option value="knowledge-pack">Update Knowledge Pack</option>
              </select>
            </label>
          </div>
          <div class="grid two">
            <label>Run Task on Change<input id="agentic-watcher-run-immediately" type="checkbox" checked></label>
            <label>Knowledge Pack Id<input id="agentic-watcher-pack-id" type="text" placeholder="weekly-status"></label>
          </div>
          <label>Target URL or File Path<input id="agentic-watcher-target" type="text" placeholder="https://example.com/status or data/notes.txt"></label>
          <div class="grid two">
            <label>Knowledge Update Mode
              <select id="agentic-watcher-knowledge-mode">
                <option value="append" selected>Append</option>
                <option value="overwrite">Overwrite</option>
                <option value="create">Create</option>
              </select>
            </label>
            <label>Summarize<input id="agentic-watcher-summarize" type="checkbox" checked></label>
          </div>
          <div class="row">
            <button id="agentic-watcher-create" type="button">Create Watcher from Current Task</button>
          </div>
          <div id="agentic-watcher-status" class="status"></div>
        </div>

        <div class="panel stack">
          <h2>Task Monitor</h2>
          <div class="row">
            <button id="agentic-refresh" type="button">Refresh</button>
            <button id="agentic-run-selected" type="button">Run Selected Task</button>
            <button id="agentic-open-chat" type="button">Open in Chat</button>
            <button id="agentic-generate-report" type="button">Generate Report</button>
          </div>
          <label>Task<select id="agentic-task-select"></select></label>
          <pre id="agentic-task-detail" class="preview"></pre>
          <div class="hint">Step observability shows inputs, outputs, and recent tool/task events for the selected task.</div>
          <pre id="agentic-task-observability" class="preview"></pre>
          <div class="hint">Latest report output (truncated):</div>
          <pre id="agentic-task-report" class="preview"></pre>
          <h3>Pending Approvals</h3>
          <div id="agentic-approvals-list" class="list"></div>
          <h3>Watchers</h3>
          <div id="agentic-watchers-list" class="list"></div>
          <h3>Workflows</h3>
          <div class="hint">MVP trigger-action workflows. Use cron (`*/5 * * * *`), webhook, runCompleted, or manual.</div>
          <label>Workflow Name<input id="agentic-workflow-name" type="text" placeholder="Daily debate monitor"></label>
          <div class="grid two">
            <label>Workflow Id<input id="agentic-workflow-id" type="text" placeholder="daily-debate-monitor"></label>
            <label>Trigger Type
              <select id="agentic-workflow-trigger-type">
                <option value="manual" selected>manual</option>
                <option value="cron">cron</option>
                <option value="webhook">webhook</option>
                <option value="runCompleted">runCompleted</option>
              </select>
            </label>
          </div>
          <div class="grid two">
            <label>Cron (if cron trigger)<input id="agentic-workflow-cron" type="text" placeholder="*/5 * * * *"></label>
            <label>Event (runCompleted)<input id="agentic-workflow-event" type="text" placeholder="run.finished"></label>
          </div>
          <label>Webhook Secret (optional)<input id="agentic-workflow-secret" type="text" placeholder="shared-secret"></label>
          <label>Workflow Steps JSON<textarea id="agentic-workflow-steps-json" rows="8">[
  {"id":"step-1","name":"Call endpoint","type":"httpRequest","input":{"url":"https://example.com","method":"GET"}},
  {"id":"step-2","name":"Persist result","type":"persistRecord","input":{"path":"data/agentic/workflow-records/example.txt","content":"{{steps.step-1.bodyPreview}}","append":false}}
]</textarea></label>
          <div class="row">
            <button id="agentic-workflow-create" type="button">Create Workflow</button>
            <button id="agentic-workflow-refresh" type="button">Refresh Workflows</button>
          </div>
          <div id="agentic-workflow-status" class="status"></div>
          <div id="agentic-workflows-list" class="list"></div>
          <h3>Workflow Runs</h3>
          <div id="agentic-workflow-runs-list" class="list"></div>
          <h3>Tool Catalog</h3>
          <div id="agentic-tools-list" class="list"></div>
        </div>
      </div>

      <div class="grid two">
        <div class="panel stack">
          <h2>Metrics</h2>
          <div id="agentic-metrics-cards" class="summary-cards"></div>
          <div id="agentic-jobs-list" class="list"></div>
        </div>
        <div class="panel stack">
          <h2>Events + MCP Readiness</h2>
          <div id="agentic-mcp-status" class="status">MCP status not loaded.</div>
          <h3>MCP Registry</h3>
          <div id="agentic-mcp-servers" class="list"></div>
          <h3>MCP Tool Runner</h3>
          <div class="row">
            <label>MCP Tool
              <select id="agentic-mcp-tool-select"></select>
            </label>
            <button id="agentic-mcp-tool-run" type="button">Run MCP Tool</button>
          </div>
          <label>Tool Input (JSON)
            <textarea id="agentic-mcp-tool-input" rows="4" placeholder='{"limit": 25}'></textarea>
          </label>
          <div id="agentic-mcp-tool-status" class="status"></div>
          <pre id="agentic-mcp-tool-output" class="preview"></pre>
          <h3>Recent Task Events</h3>
          <pre id="agentic-task-events" class="preview"></pre>
          <h3>Recent Tool Usage</h3>
          <pre id="agentic-tool-events" class="preview"></pre>
        </div>
      </div>
    </section>

    <section id="tab-simple-chat" class="tab-section">
      <div class="chat-shell">
        <aside id="simple-chat-sidebar" class="panel stack chat-sidebar">
          <div class="row">
            <h3>History</h3>
            <button id="simple-chat-toggle-sidebar" type="button">Hide</button>
            <button id="simple-chat-refresh-list" type="button">Refresh</button>
          </div>
          <div id="simple-chat-session-list" class="list"></div>
        </aside>

        <div class="panel stack chat-main">
          <div class="row">
            <button id="simple-chat-show-sidebar" type="button" class="hidden">Show History</button>
            <h2>Simple Chat <span class="tip" tabindex="0">?<span class="tip-flyout">Single-assistant conversation with optional knowledge grounding and session history.</span></span></h2>
            <button id="simple-chat-new-draft" type="button">New Chat</button>
            <button id="simple-chat-to-agentic" type="button">Create Agentic Task</button>
          </div>
          <details id="simple-chat-config-details" class="setup-advanced" open>
            <summary>Session Configuration</summary>
            <label>Chat Title<input id="simple-chat-title" type="text" value="Simple Chat"></label>
            <label>Shared Context<textarea id="simple-chat-context" rows="3" placeholder="Optional background instructions for this chat"></textarea></label>
            <div class="grid two">
              <label>Model
                <select id="simple-chat-model">
                </select>
              </label>
              <label>Temperature<input id="simple-chat-temperature" type="number" min="0" max="2" step="0.1" value="0.4"></label>
              <label>Max Response Words<input id="simple-chat-max-words" type="number" min="40" max="800" value="220"></label>
            </div>
            <div class="hint model-routing-hint">Azure mode: the selected model label maps to an Azure deployment using `azureInference.deployments`.</div>
            <div id="simple-chat-model-meta" class="model-runtime-meta"></div>
            <div id="simple-chat-router-status" class="provider-status-card hidden"></div>
            <div class="compare-config">
              <label class="inline compare-toggle"><input id="simple-chat-compare-enabled" type="checkbox"> Compare with additional models</label>
              <div id="simple-chat-compare-wrap" class="stack compare-config-body hidden">
                <div class="compare-config-note">Run the same prompt through extra models. The primary answer still drives the conversation.</div>
                <div id="simple-chat-compare-models" class="list compare-model-list"></div>
                <div id="simple-chat-compare-summary" class="compare-config-summary">No comparison models selected.</div>
              </div>
            </div>
            <h3>Knowledge Packs (Optional)</h3>
            <div id="simple-chat-knowledge-list" class="list"></div>
            <div class="row">
              <button id="simple-chat-create" type="button">New Chat</button>
            </div>
            <div id="simple-chat-create-status" class="status"></div>
          </details>
          <div class="hidden">
            <label>Chat Id<input id="simple-chat-id" type="text" placeholder="Create or load a simple chat id"></label>
            <button id="simple-chat-load" type="button">Load</button>
          </div>
          <div id="simple-chat-status" class="status">Create or select a session from history to begin.</div>
          <div id="simple-chat-history" class="chat-history"></div>
          <div class="row">
            <input id="simple-chat-message" type="text" placeholder="Ask anything, optionally grounded in selected knowledge packs">
            <button id="simple-chat-send" type="button">Send</button>
            <button id="simple-chat-image" type="button">Force Image</button>
          </div>
          <div class="hint">Citations appear automatically when matching knowledge pack evidence is found. Use normal Send for clear image requests; use Force Image or <code>/image</code> only when you want to bypass intent detection.</div>
        </div>
      </div>
    </section>

    <section id="tab-persona-chat" class="tab-section">
      <div class="chat-shell">
        <aside id="persona-chat-sidebar" class="panel stack chat-sidebar">
          <div class="row">
            <h3>History</h3>
            <button id="persona-chat-toggle-sidebar" type="button">Hide</button>
            <button id="persona-chat-refresh-list" type="button">Refresh</button>
          </div>
          <div id="persona-chat-session-list" class="list"></div>
        </aside>

        <div class="panel stack chat-main">
          <div class="row">
            <button id="persona-chat-show-sidebar" type="button" class="hidden">Show History</button>
            <h2>Persona Collaboration Chat <span class="tip" tabindex="0">?<span class="tip-flyout">Create a free-form chat session with one or more personas. An orchestrator picks the most relevant subset each turn, so not everyone replies every time.</span></span></h2>
            <button id="persona-chat-new-draft-main" type="button">New Chat</button>
            <button id="persona-chat-to-agentic" type="button">Create Agentic Task</button>
          </div>
          <div class="row">
            <button id="group-work-live" type="button">Live Group Chat</button>
            <button id="group-work-debate-viewer" type="button">Conversation Explorer</button>
          </div>
          <details id="persona-chat-config-details" class="setup-advanced" open>
            <summary>Session Configuration</summary>
            <label>Chat Title<input id="persona-chat-title" type="text" value="Persona Collaboration Chat"></label>
            <label>Shared Context<textarea id="persona-chat-context" rows="3" placeholder="Optional context shared across all persona responses"></textarea></label>
            <div class="hint">Participants are selected lower in this panel. The model setting here controls the conversation backbone used for persona turns and moderator turns.</div>
            <div class="grid two">
              <label>Conversation Backbone
                <select id="persona-chat-model">
                </select>
              </label>
              <label>Temperature<input id="persona-chat-temperature" type="number" min="0" max="2" step="0.1" value="0.6"></label>
              <label>Max Words / Persona Turn<input id="persona-chat-max-words" type="number" min="40" max="400" value="140"></label>
              <label>Engagement Mode
                <select id="persona-chat-mode">
                  <option value="chat" selected>Interactive Chat (Directed)</option>
                  <option value="panel">Panel Discussion (Moderated)</option>
                  <option value="debate-work-order">Debate to Decision (Moderated)</option>
                </select>
              </label>
              <label>Panel Auto Rounds
                <input id="persona-chat-panel-rounds" type="number" min="0" max="4" value="2">
              </label>
            </div>
            <div class="hint model-routing-hint">Choose a direct model or `Auto (Foundry Router)` for dynamic selection. Foundry applications belong in the participant selector below.</div>
            <div id="persona-chat-model-meta" class="model-runtime-meta"></div>
            <div class="compare-config">
              <label class="inline compare-toggle"><input id="persona-chat-compare-enabled" type="checkbox"> Compare persona turns across additional models</label>
              <div id="persona-chat-compare-wrap" class="stack compare-config-body hidden">
                <div class="compare-config-note">Run the same persona prompt through extra models. Tool-using turns skip comparison to avoid duplicate side effects.</div>
                <div id="persona-chat-compare-models" class="list compare-model-list"></div>
                <div id="persona-chat-compare-summary" class="compare-config-summary">No comparison models selected.</div>
              </div>
            </div>
            <div id="persona-chat-mode-help" class="hint">Interactive chat: personas mostly reply when directly addressed. If unclear, moderator routes the turn and gives guidance.</div>
            <h3>Knowledge Packs (Optional)</h3>
            <div id="persona-chat-knowledge-list" class="list"></div>
            <h3>Templates</h3>
            <div class="row">
              <button id="persona-chat-template-debate" type="button">Load Debate Mode Template</button>
            </div>
            <div class="hint">Copies selected personas, knowledge packs, and context into Structured Debate Run below.</div>
            <details id="persona-chat-debate-details" class="setup-advanced">
              <summary>Structured Debate Run (Topic Discovery, Persona Recommendations, Settings)</summary>
              <div id="persona-chat-debate-host" class="stack">
<div class="grid two">
        <div class="panel stack">
          <h2>Structured Debate Run <span class="tip" tabindex="0">?<span class="tip-flyout">Configure participants and settings for a structured debate run within Group Chat. Turns execute sequentially.</span></span></h2>
          <div class="setup-step stack">
            <h3>Step 1: Define Topic</h3>
            <div class="hint">Debate mode uses the Group Chat <strong>Chat Title</strong> and <strong>Shared Context</strong> fields above as the topic/context source.</div>
            <div class="hint">Update those fields in Session Configuration to change the debate question and background.</div>
          </div>

          <details class="setup-advanced">
            <summary>Advanced Setup (Topic Discovery, Persona Generation, Settings, Knowledge, Participants)</summary>

          <div class="setup-step stack">
            <h3>Step 2: Discover Topic Sources (Optional)</h3>
            <div class="hint">Use current events search, or skip and work from your manual topic above.</div>
            <div class="row">
              <input id="topic-discovery-query" type="text" placeholder="Search current events (e.g., ai regulation, election policy)">
              <button id="topic-discovery-search" type="button">Search Events</button>
              <button id="topic-use-manual" type="button">Use Manual Topic</button>
            </div>
            <div id="topic-discovery-results" class="list"></div>
            <div id="topic-selected-summary" class="status">No current-event topic selected. Manual topic generation is available.</div>
          </div>

          <div class="setup-step stack">
            <h3>Step 3: Generate Personas (Optional)</h3>
            <div class="hint">Generates from selected event topic when available, otherwise from manual Topic/Context.</div>
            <div class="row">
              <label>Generated Personas<input id="topic-persona-count" type="number" min="1" max="6" value="3"></label>
              <button id="topic-generate-personas" type="button">Generate Personas</button>
            </div>
            <div id="topic-generated-drafts" class="list"></div>
          </div>

          <div class="setup-step stack">
            <h3>Step 4: Configure Debate Mode Settings</h3>
          <div class="grid two">
            <label>Rounds <span class="tip" tabindex="0">?<span class="tip-flyout">Number of speaking rounds per persona. Higher values cost more tokens/time.</span></span><input id="debate-rounds" type="number" min="1" max="8" value="3"></label>
            <label>Max Words / Turn <span class="tip" tabindex="0">?<span class="tip-flyout">Hard target for brevity in each generated turn.</span></span><input id="debate-max-words" type="number" min="40" max="400" value="120"></label>
            <label>Temperature<input id="debate-temperature" type="number" min="0" max="2" step="0.1" value="0.7"></label>
            <label>Model
              <select id="debate-model">
              </select>
            </label>
            <label>Source Grounding
              <select id="debate-source-grounding">
                <option value="light" selected>Light</option>
                <option value="strict">Strict</option>
                <option value="off">Off</option>
              </select>
            </label>
          </div>
          <div class="hint model-routing-hint">Azure mode: the selected model is used as a lookup key in `azureInference.deployments` before the request is sent.</div>
          <div id="debate-model-meta" class="model-runtime-meta"></div>
          <label>Moderation Style<input id="debate-moderation-style" type="text" value="neutral"></label>
          <label class="inline"><input id="debate-include-moderator" type="checkbox" checked> Include moderator</label>
          </div>
          <div class="setup-step stack">
          <h3>Step 5: Attach Knowledge (Optional)</h3>
          <div class="hint">These packs are global to all participants. Persona-specific packs can be set in Persona profiles.</div>
          <div id="knowledge-pack-list" class="list"></div>
          </div>

          <div class="setup-step stack">
            <h3>Step 6: Select Participants</h3>
            <h3>Available Saved Personas</h3>
            <div id="available-personas" class="list"></div>

            <h3>Add Ad-hoc Persona <span class="tip" tabindex="0">?<span class="tip-flyout">Use this for one-off participants. Enable ‚ÄúSave persona‚Äù to persist into data/personas.</span></span></h3>
            <div class="stack">
              <label>Display Name<input id="adhoc-displayName" type="text"></label>
              <label>Description<input id="adhoc-description" type="text"></label>
              <label>System Prompt<textarea id="adhoc-systemPrompt" rows="4"></textarea></label>
              <label>Role<input id="adhoc-role" type="text"></label>
              <label>Tone<input id="adhoc-tone" type="text"></label>
              <label>Verbosity<input id="adhoc-verbosity" type="text"></label>
              <label>Quirks (comma-separated)<input id="adhoc-quirks" type="text"></label>
              <label>Expertise Tags (comma-separated)<input id="adhoc-tags" type="text"></label>
              <label>Bias/Values<input id="adhoc-bias" type="text"></label>
              <label>Debate Behavior<textarea id="adhoc-debateBehavior" rows="2"></textarea></label>
              <label>Tool IDs (comma-separated)<input id="adhoc-tool-ids" type="text" placeholder="optional: web.fetch, http.request"></label>
              <label>Knowledge Pack Ids (comma-separated)<input id="adhoc-knowledge-pack-ids" type="text" placeholder="optional: debate-quality-rubric, current-events-analysis"></label>
              <label class="inline"><input id="adhoc-save" type="checkbox"> Save persona</label>
              <label>Save Id (required if save checked)<input id="adhoc-id" type="text" placeholder="new-persona-id"></label>
              <button id="add-adhoc" type="button">Add Ad-hoc Persona</button>
            </div>
          </div>
          </details>
        </div>

        <div class="panel stack">
          <h2>Debate Participants (Ordered) <span class="tip" tabindex="0">?<span class="tip-flyout">Order controls speaking sequence each round. Use Up/Down before running.</span></span></h2>
          <div class="hint">
            Run path:
            <strong>Option A</strong> add/reorder personas manually.
            <strong>Option B</strong> leave this list empty and the orchestrator auto-selects personas from saved profiles.
          </div>
          <div class="row">
            <button id="debate-sync-from-group" type="button">Use Current Group Personas</button>
          </div>
          <div class="hint">Copies currently selected Group Chat personas and knowledge packs into this debate-mode participant list.</div>
          <div id="selected-personas" class="list"></div>
            <button id="run-debate" type="button">Run Structured Debate</button>
          <div id="debate-run-status" class="status"></div>
        </div>
      </div>
              </div>
            </details>
            <h3>Select Participants (One or More)</h3>
            <div class="row">
              <input id="persona-chat-persona-filter" type="text" placeholder="Filter personas or Foundry apps by name or id">
              <button id="persona-chat-select-all" type="button">Select Visible</button>
              <button id="persona-chat-clear-all" type="button">Clear</button>
            </div>
            <div class="hint">This list can include saved personas and configured Foundry applications. Selected participants become the speakers in the session.</div>
            <div id="persona-chat-persona-list" class="list persona-chat-persona-list"></div>
            <div class="row">
              <button id="persona-chat-create" type="button">New Chat</button>
              <button id="persona-chat-new-draft" type="button">Reset Draft</button>
            </div>
            <div id="persona-chat-create-status" class="status"></div>
          </details>
          <div class="hidden">
            <label>Chat Id<input id="persona-chat-id" type="text" placeholder="Create or load a chat id"></label>
            <button id="persona-chat-load" type="button">Load</button>
          </div>
          <div id="persona-chat-status" class="status">Create or select a session from history to begin.</div>
          <div id="persona-chat-history" class="chat-history"></div>
          <div id="persona-chat-mention-strip" class="mention-strip"></div>
          <div class="row">
            <input id="persona-chat-message" type="text" placeholder="Ask your selected personas anything">
            <button id="persona-chat-send" type="button">Send</button>
          </div>
          <div class="hint">Image intent is auto-detected. Use <code>/image</code> or a clear subject like "generate an image of alpine lake at sunrise." Vague mentions won't trigger image mode.</div>
        </div>
      </div>
    </section>

    <section id="tab-viewer" class="tab-section">
      <div class="panel stack">
        <h2>Conversation Explorer <span class="tip" tabindex="0">?<span class="tip-flyout">Browse conversation history by type. Select and open any session to monitor exchange-level risk flags.</span></span></h2>
        <div class="row">
          <label>Type
            <select id="viewer-conversation-type">
              <option value="debate" selected>Debate</option>
              <option value="group">Group Chat</option>
              <option value="simple">Simple Chat</option>
            </select>
          </label>
          <label>Conversation
            <select id="viewer-conversation-select">
              <option value="">Select conversation</option>
            </select>
          </label>
          <button id="load-conversation" type="button">Load</button>
          <button id="viewer-open-stage" type="button" disabled>Open Stage Replay</button>
          <span class="hint">Load a conversation first to enable replay.</span>
          <a id="download-transcript" href="#" target="_blank" rel="noopener">Download Transcript</a>
        </div>
        <div id="viewer-history-list" class="list"></div>
        <div id="viewer-progress" class="status"></div>
        <pre id="viewer-transcript" class="transcript"></pre>
        <div class="panel stack">
          <h3>Exchange Risk Signals</h3>
          <div class="hint">Stoplight indicators are heuristic signals based on text content and sentiment terms.</div>
          <div id="viewer-turns" class="chat-history"></div>
        </div>
        <div id="viewer-transcript-chat" class="chatbox stack">
          <h3>Transcript Chat</h3>
          <div class="hint">
            Ask questions about the currently loaded transcript (debate-mode sessions). Responses are grounded in transcript excerpts.
          </div>
          <div id="chat-history" class="chat-history"></div>
          <div class="row">
            <input id="chat-question" type="text" placeholder="Ask about arguments, agreements, or takeaways">
            <button id="chat-send" type="button">Ask</button>
            <button id="chat-citations-open" type="button">Show Citations</button>
          </div>
          <div id="chat-status" class="status"></div>
        </div>
      </div>
    </section>

    <section id="tab-admin" class="tab-section">
      <div class="grid two">
        <div class="panel stack governance-panel governance-panel-main">
          <h2>Governance Dashboard <span class="tip" tabindex="0">?<span class="tip-flyout">Use matrix drilldowns to inspect usage, cost, risk, sentiment, and user dimensions.</span></span></h2>
          <div id="admin-summary-cards" class="summary-cards"></div>
          <div class="admin-matrix-controls admin-matrix-toolbar row">
            <span class="hint">Matrix Dimension</span>
            <button id="admin-dim-channel" type="button">Channel</button>
            <button id="admin-dim-model" type="button">Model</button>
            <button id="admin-dim-persona" type="button">Persona</button>
            <button id="admin-dim-user" type="button">User</button>
            <button id="admin-clear-filter" type="button">Clear Drill Filter</button>
          </div>
          <div id="admin-filter-summary" class="hint">No active drill filter.</div>
          <div id="admin-matrix" class="admin-matrix"></div>
          <div class="row admin-view-toolbar">
            <button id="admin-view-debates" type="button">Conversation View</button>
            <button id="admin-view-chats" type="button">Chat View</button>
            <button id="admin-view-personas" type="button">Persona View</button>
            <button id="admin-view-tools" type="button">Tool Usage</button>
            <button id="admin-refresh" type="button">Refresh</button>
          </div>
          <div id="admin-pricing-note" class="hint"></div>
          <div class="governance-section-label">Drillthrough Details</div>
          <div id="admin-list" class="list"></div>
        </div>

        <div class="panel stack governance-panel">
          <h2>Visual Analytics</h2>
          <div id="admin-chart-status" class="status">Charts update from current matrix filters.</div>
          <details class="admin-heatmap-section">
            <summary>Coverage Heatmap</summary>
            <div class="row governance-control-row">
              <label>Coverage Heatmap
                <select id="admin-heatmap-mode">
                  <option value="capability">Agent x Capability</option>
                  <option value="topic">Agent x Topic</option>
                </select>
              </label>
              <button id="admin-heatmap-refresh" type="button">Refresh Heatmap</button>
            </div>
            <div id="admin-heatmap-status" class="status">Loading heatmap...</div>
            <div id="admin-heatmap-note" class="hint">
              Heatmap score blends message share, token share, novelty, citation/tool activity, and user follow-up engagement.
            </div>
            <div id="admin-heatmap-legend" class="hint"></div>
            <div id="admin-heatmap" class="admin-heatmap"></div>
          </details>
          <div id="admin-charts" class="stack"></div>
          <div class="governance-section-label">Operational Monitoring</div>
          <h3>Tool Usage Monitor</h3>
          <div class="row governance-control-row">
            <label>Tool
              <input id="admin-tool-filter-tool" type="text" placeholder="web.fetch">
            </label>
            <label>Context
              <select id="admin-tool-filter-context">
                <option value="">All</option>
                <option value="persona-chat">Persona Chat</option>
                <option value="task">Task Runner</option>
              </select>
            </label>
            <label>Status
              <select id="admin-tool-filter-status">
                <option value="">All</option>
                <option value="ok">Success</option>
                <option value="error">Failed</option>
              </select>
            </label>
            <button id="admin-tool-refresh" type="button">Refresh Tool Runs</button>
          </div>
          <div id="admin-tool-status" class="status">Loading tool usage...</div>
          <div id="admin-tool-usage-list" class="list"></div>
          <div class="row governance-nav-row">
            <button id="admin-nav-group-history" type="button">Open Group Chat History</button>
            <button id="admin-nav-simple-history" type="button">Open Simple Chat History</button>
            <button id="admin-nav-debate-history" type="button">Open Conversation Explorer</button>
          </div>
          <div class="governance-section-label">Governance Assistant</div>
          <h3>Governance Admin Chat <span class="tip" tabindex="0">?<span class="tip-flyout">Admin-only chat backed by a hidden governance dataset knowledge pack and hidden governance persona.</span></span></h3>
          <div class="row governance-control-row">
            <button id="gov-chat-create" type="button">New Governance Chat</button>
            <label>Find Past Chat<input id="gov-chat-search" type="text" placeholder="Search by id or title"></label>
            <button id="gov-chat-search-btn" type="button">Search</button>
          </div>
          <div id="gov-chat-create-status" class="status">Create or load a governance chat session.</div>
          <div id="gov-chat-search-status" class="hint hidden">Search results appear here.</div>
          <div id="gov-chat-session-list" class="list hidden"></div>
          <div class="row governance-control-row">
            <label>Chat Id<input id="gov-chat-id" type="text" placeholder="Load governance chat id"></label>
            <button id="gov-chat-load" type="button">Load</button>
          </div>
          <div id="gov-chat-status" class="status">No governance chat loaded.</div>
          <div id="gov-chat-history" class="chat-history"></div>
          <div class="row">
            <input id="gov-chat-message" type="text" placeholder="Ask governance questions (cost, tokens, risky users, topics)">
            <button id="gov-chat-send" type="button">Send</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <aside id="citations-popout" class="citations-popout" aria-hidden="true">
    <div class="citations-header">
      <h3>Citations</h3>
      <button id="chat-citations-close" type="button">Close</button>
    </div>
    <div id="chat-citations-list" class="citations-list"></div>
  </aside>

  <aside id="help-popout" class="citations-popout" aria-hidden="true">
    <div class="citations-header">
      <h3 id="help-title">Usage Guide</h3>
      <button id="help-close" type="button">Close</button>
    </div>
    <div id="help-body" class="citations-list"></div>
  </aside>

  <aside id="support-popout" class="citations-popout support-popout" aria-hidden="true">
    <div class="citations-header">
      <h3>Support Concierge</h3>
      <button id="support-close" type="button">Close</button>
    </div>
    <div id="support-status" class="status">Ask a question about UI usage, troubleshooting, or APIs.</div>
    <div id="support-history" class="chat-history support-history"></div>
    <div class="row"><button id="support-clear" type="button">Clear</button></div>
    <div class="row">
      <input id="support-message" type="text" placeholder="How do I run debate mode?">
      <button id="support-send" type="button">Send</button>
    </div>
    <div>
      <strong class="muted">Latest citations</strong>
      <div id="support-citations" class="citations-list"></div>
    </div>
  </aside>

  <aside id="viewer-stage-popout" class="citations-popout support-popout" aria-hidden="true">
    <div class="citations-header">
      <h3>Conversation Stage Replay</h3>
      <button id="viewer-stage-close" type="button">Close</button>
    </div>
    <div id="viewer-stage-status" class="status">Load a conversation from Explorer first.</div>
    <div class="row">
      <button id="viewer-stage-prev" type="button">Prev</button>
      <button id="viewer-stage-play" type="button">Play</button>
      <button id="viewer-stage-next" type="button">Next</button>
      <label>Speed
        <select id="viewer-stage-speed">
          <option value="0.75">0.75x</option>
          <option value="1" selected>1x</option>
          <option value="1.5">1.5x</option>
          <option value="2">2x</option>
        </select>
      </label>
    </div>
    <div id="viewer-stage-roster" class="stage-roster"></div>
    <div id="viewer-stage-transcript" class="chat-history stage-transcript"></div>
    <details>
      <summary>Turn Explainability</summary>
      <pre id="viewer-stage-trace" class="preview"></pre>
    </details>
  </aside>

  <div id="image-preview-modal" class="image-preview hidden">
    <div class="image-preview-backdrop"></div>
    <div class="image-preview-panel">
      <div class="image-preview-header">
        <div id="image-preview-title" class="muted">Image Preview</div>
        <div class="image-preview-actions">
          <button id="image-preview-zoom-out" type="button">-</button>
          <button id="image-preview-zoom-reset" type="button">Reset</button>
          <button id="image-preview-zoom-in" type="button">+</button>
          <a id="image-preview-download" class="image-preview-download" href="#" download>Download</a>
          <button id="image-preview-close" type="button">Close</button>
        </div>
      </div>
      <div class="image-preview-body">
        <img id="image-preview-img" alt="Preview">
      </div>
    </div>
  </div>

  <datalist id="llm-model-options">
    <option value="gpt-5-mini"></option>
    <option value="gpt-5.2"></option>
    <option value="gpt-4.1"></option>
    <option value="gpt-4o"></option>
    <option value="gpt-4o-mini"></option>
  </datalist>

  <script type="module" src="/app.js"></script>
</body>
</html>
