<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Documentation</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,600;9..144,700&family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      color-scheme: light;
      --bg: #f7f4ee;
      --bg-soft: #fffdf8;
      --ink: #1f2933;
      --ink-soft: #4b5563;
      --line: #d9d7d1;
      --card: #fffefb;
      --accent: #0f766e;
      --accent-strong: #115e59;
      --accent-soft: #e7faf5;
      --shadow: 0 14px 36px rgba(23, 32, 43, 0.09);
      --radius: 14px;
      --font-body: "Space Grotesk", "Work Sans", system-ui, -apple-system, Segoe UI, sans-serif;
      --font-display: "Fraunces", Georgia, serif;
    }
    body {
      font-family: var(--font-body);
      margin: 0;
      background: var(--bg);
      color: var(--ink);
    }
    .layout { display: grid; grid-template-columns: 280px 1fr; min-height: 100vh; }
    .sidebar {
      background: linear-gradient(160deg, var(--ink) 0%, #0b1624 100%);
      color: #e2e8f0;
      padding: 16px;
      display: grid;
      gap: 10px;
      align-content: start;
    }
    .sidebar h1 { font-size: 18px; margin: 0; color: #f8fafc; font-family: var(--font-display); }
    .sidebar .muted { color: #94a3b8; font-size: 12px; }
    .doc-btn, .link-btn {
      width: 100%;
      text-align: left;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(15, 23, 42, 0.8);
      color: #e5e7eb;
      border-radius: 10px;
      padding: 10px;
      cursor: pointer;
    }
    .doc-btn.active { background: var(--accent); border-color: var(--accent); color: #fff; }
    .link-btn { background: rgba(11, 18, 32, 0.9); }
    .content { padding: 18px; display: grid; gap: 12px; }
    .toolbar { display: flex; gap: 8px; flex-wrap: wrap; }
    .toolbar a { text-decoration: none; color: var(--accent); font-weight: 600; }
    .card { background: var(--card); border: 1px solid var(--line); border-radius: var(--radius); padding: 16px; box-shadow: var(--shadow); }
    .markdown-body { line-height: 1.6; }
    .markdown-body h1, .markdown-body h2, .markdown-body h3 { line-height: 1.25; margin-top: 1.2em; font-family: var(--font-display); }
    .markdown-body pre { background: #0b1220; color: #e2e8f0; padding: 10px; border-radius: 10px; overflow: auto; }
    .markdown-body code { background: var(--bg-soft); padding: 2px 5px; border-radius: 6px; }
    .markdown-body pre code { background: transparent; padding: 0; }
    .status { color: var(--ink-soft); font-size: 12px; }
    @media (max-width: 900px) { .layout { grid-template-columns: 1fr; } .sidebar { position: sticky; top: 0; z-index: 10; } }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <h1>Documentation</h1>
      <div class="muted">Read guides in a rendered, easy-to-scan format.</div>
      <button class="doc-btn active" data-doc="FIRST_10_MINUTES.md">First 10 Minutes</button>
      <button class="doc-btn" data-doc="USER_GUIDE.md">User Guide</button>
      <button class="doc-btn" data-doc="UI_NAVIGATION.md">UI Navigation Map</button>
      <button class="doc-btn" data-doc="API_GUIDE.md">API Guide</button>
      <button class="doc-btn" data-doc="TROUBLESHOOTING.md">Troubleshooting</button>
      <button class="doc-btn" data-doc="FAQ.md">FAQ</button>
      <button class="doc-btn" data-doc="../README.md">README</button>
      <hr style="border-color:#1e293b; width:100%" />
      <a class="link-btn" href="/docs/api" target="_blank" rel="noopener">Open Swagger API Docs</a>
      <a class="link-btn" href="/docs/openapi.yaml" target="_blank" rel="noopener">Open OpenAPI YAML</a>
      <a class="link-btn" href="/support" target="_blank" rel="noopener">Open Support Concierge</a>
    </aside>

    <main class="content">
      <div class="toolbar card">
        <a id="open-raw" href="/docs/FIRST_10_MINUTES.md" target="_blank" rel="noopener">Open Raw Markdown</a>
        <span id="doc-status" class="status">Loaded: FIRST_10_MINUTES.md</span>
      </div>
      <article class="card markdown-body" id="doc-render">Loading documentation...</article>
    </main>
  </div>

  <script>
    const byId = (id) => document.getElementById(id);
    const docButtons = Array.from(document.querySelectorAll('.doc-btn'));

    function applyTheme(theme) {
      if (!theme || typeof theme !== 'object') return;
      const root = document.documentElement;
      const vars = theme.variables && typeof theme.variables === 'object' ? theme.variables : {};
      Object.entries(vars).forEach(([key, value]) => {
        if (!key || typeof value === 'undefined') return;
        root.style.setProperty(String(key), String(value));
      });
      const typography = theme.typography && typeof theme.typography === 'object' ? theme.typography : {};
      if (typography.body) root.style.setProperty('--font-body', String(typography.body));
      if (typography.display) root.style.setProperty('--font-display', String(typography.display));
    }

    async function loadTheme() {
      try {
        const res = await fetch('/theme', { credentials: 'include' });
        if (!res.ok) return;
        const payload = await res.json().catch(() => ({}));
        applyTheme(payload?.data?.theme || payload?.theme || null);
      } catch {
        // ignore
      }
    }

    function safeHtml(text) {
      return String(text || '').replace(/<script\b[^>]*>([\s\S]*?)<\/script>/gi, '');
    }

    async function loadDoc(docPath) {
      const url = docPath === '../README.md' ? '/docs/README.md' : `/docs/${docPath}`;
      byId('doc-status').textContent = `Loading: ${docPath}`;
      byId('open-raw').href = url;
      try {
        const res = await fetch(url, { credentials: 'include' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const markdown = await res.text();
        const html = marked.parse(markdown || '');
        byId('doc-render').innerHTML = safeHtml(html);
        byId('doc-status').textContent = `Loaded: ${docPath}`;
      } catch (error) {
        byId('doc-render').innerHTML = `<p>Failed to load documentation: ${String(error.message || error)}</p>`;
        byId('doc-status').textContent = `Failed: ${docPath}`;
      }
    }

    docButtons.forEach((btn) => {
      btn.addEventListener('click', () => {
        docButtons.forEach((b) => b.classList.remove('active'));
        btn.classList.add('active');
        loadDoc(btn.dataset.doc || 'FIRST_10_MINUTES.md');
      });
    });

    loadTheme();
    loadDoc('FIRST_10_MINUTES.md');
  </script>
</body>
</html>
